# ğŸ—ï¸ ç›‘æ§ä½“ç³»æ¶æ„è®¾è®¡

> æ·±å…¥ç†è§£ Prometheus + Grafana ç›‘æ§æ¶æ„çš„è®¾è®¡åŸç†å’Œæœ€ä½³å®è·µ

## ğŸ“‹ æ¶æ„æ¦‚è§ˆ

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†åŸºäº Prometheus å’Œ Grafana çš„äº‘åŸç”Ÿç›‘æ§ä½“ç³»æ¶æ„ï¼ŒåŒ…æ‹¬ç»„ä»¶è®¾è®¡ã€æ•°æ®æµå‘ã€æ‰©å±•ç­–ç•¥ç­‰æ ¸å¿ƒå†…å®¹ã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡
- **é«˜å¯ç”¨æ€§**: ç›‘æ§ç³»ç»Ÿæœ¬èº«ä¸èƒ½æˆä¸ºå•ç‚¹æ•…éšœ
- **å¯æ‰©å±•æ€§**: æ”¯æŒå¤§è§„æ¨¡é›†ç¾¤å’Œæµ·é‡æŒ‡æ ‡
- **å®æ—¶æ€§**: å¿«é€Ÿå‘ç°å’Œå“åº”ç³»ç»Ÿå¼‚å¸¸
- **æ˜“ç”¨æ€§**: ç®€åŒ–é…ç½®å’Œä½¿ç”¨å¤æ‚åº¦

### æŠ€æœ¯è¦æ±‚
- **æ•°æ®å‡†ç¡®æ€§**: ç¡®ä¿ç›‘æ§æ•°æ®çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§
- **æŸ¥è¯¢æ€§èƒ½**: æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œå¤§æ—¶é—´èŒƒå›´åˆ†æ
- **å­˜å‚¨æ•ˆç‡**: ä¼˜åŒ–å­˜å‚¨ç©ºé—´å’ŒæŸ¥è¯¢é€Ÿåº¦
- **å®‰å…¨æ€§**: ä¿æŠ¤ç›‘æ§æ•°æ®å’Œè®¿é—®æ§åˆ¶

## ğŸ›ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç›‘æ§ä½“ç³»æ¶æ„å›¾                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   åº”ç”¨å±‚     â”‚    â”‚   å¹³å°å±‚     â”‚    â”‚   åŸºç¡€è®¾æ–½   â”‚     â”‚
â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚ â”‚å¾®æœåŠ¡ A â”‚ â”‚    â”‚ â”‚Kubernetesâ”‚ â”‚    â”‚ â”‚  èŠ‚ç‚¹   â”‚ â”‚     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚ â”‚å¾®æœåŠ¡ B â”‚ â”‚    â”‚ â”‚  Istio  â”‚ â”‚    â”‚ â”‚ å­˜å‚¨    â”‚ â”‚     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                   â”‚                   â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                             â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   æ•°æ®æ”¶é›†å±‚                             â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚  â”‚ â”‚ Node        â”‚ â”‚ cAdvisor    â”‚ â”‚ Kube State  â”‚       â”‚ â”‚
â”‚  â”‚ â”‚ Exporter    â”‚ â”‚             â”‚ â”‚ Metrics     â”‚       â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚  â”‚ â”‚ App         â”‚ â”‚ Custom      â”‚ â”‚ Third-party â”‚       â”‚ â”‚
â”‚  â”‚ â”‚ Metrics     â”‚ â”‚ Exporters   â”‚ â”‚ Exporters   â”‚       â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   å­˜å‚¨å’Œå¤„ç†å±‚                           â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚                Prometheus                           â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                                                     â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â”‚ Scraper â”‚ â”‚ Storage â”‚ â”‚ Query   â”‚ â”‚ Alert   â”‚   â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â”‚         â”‚ â”‚ Engine  â”‚ â”‚ Engine  â”‚ â”‚ Manager â”‚   â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   å¯è§†åŒ–å’Œå‘Šè­¦å±‚                         â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚  â”‚ â”‚   Grafana   â”‚ â”‚ AlertManagerâ”‚ â”‚   Webhook   â”‚       â”‚ â”‚
â”‚  â”‚ â”‚             â”‚ â”‚             â”‚ â”‚   Receiver  â”‚       â”‚ â”‚
â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚             â”‚       â”‚ â”‚
â”‚  â”‚ â”‚ â”‚Dashboardâ”‚ â”‚ â”‚ â”‚ Rules   â”‚ â”‚ â”‚             â”‚       â”‚ â”‚
â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚             â”‚       â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. Prometheus æœåŠ¡å™¨

**åŠŸèƒ½èŒè´£**:
- æŒ‡æ ‡æ•°æ®æ”¶é›†å’Œå­˜å‚¨
- æŸ¥è¯¢è¯­è¨€ (PromQL) æ‰§è¡Œ
- å‘Šè­¦è§„åˆ™è¯„ä¼°
- æœåŠ¡å‘ç°å’Œç›®æ ‡ç®¡ç†

**å…³é”®ç‰¹æ€§**:
```yaml
# Prometheus é…ç½®ç¤ºä¾‹
global:
  scrape_interval: 15s      # å…¨å±€æŠ“å–é—´éš”
  evaluation_interval: 15s  # è§„åˆ™è¯„ä¼°é—´éš”
  external_labels:          # å¤–éƒ¨æ ‡ç­¾
    cluster: 'production'
    region: 'us-west-2'

# è§„åˆ™æ–‡ä»¶
rule_files:
  - "rules/kubernetes.yml"
  - "rules/applications.yml"
  - "rules/infrastructure.yml"

# æŠ“å–é…ç½®
scrape_configs:
  - job_name: 'kubernetes-nodes'
    kubernetes_sd_configs:
      - role: node
    relabel_configs:
      - source_labels: [__address__]
        regex: '(.*):10250'
        target_label: __address__
        replacement: '${1}:9100'
```

### 2. Grafana å¯è§†åŒ–å¹³å°

**åŠŸèƒ½èŒè´£**:
- æ•°æ®å¯è§†åŒ–å’Œä»ªè¡¨æ¿
- ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- å‘Šè­¦é€šçŸ¥å’Œç®¡ç†
- æ•°æ®æºé›†æˆ

**æ¶æ„ç»„ä»¶**:
```
Grafana æ¶æ„
â”œâ”€â”€ Frontend (React)
â”‚   â”œâ”€â”€ Dashboard Editor
â”‚   â”œâ”€â”€ Panel Plugins
â”‚   â””â”€â”€ User Interface
â”œâ”€â”€ Backend (Go)
â”‚   â”œâ”€â”€ HTTP API
â”‚   â”œâ”€â”€ Authentication
â”‚   â”œâ”€â”€ Data Sources
â”‚   â””â”€â”€ Alerting Engine
â””â”€â”€ Database
    â”œâ”€â”€ SQLite (é»˜è®¤)
    â”œâ”€â”€ MySQL
    â””â”€â”€ PostgreSQL
```

### 3. æ•°æ®æ”¶é›†ç»„ä»¶

#### Node Exporter
- **ç”¨é€”**: æ”¶é›†èŠ‚ç‚¹çº§åˆ«çš„ç³»ç»ŸæŒ‡æ ‡
- **æŒ‡æ ‡ç±»å‹**: CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿ
- **éƒ¨ç½²æ–¹å¼**: DaemonSet

#### cAdvisor
- **ç”¨é€”**: æ”¶é›†å®¹å™¨èµ„æºä½¿ç”¨æŒ‡æ ‡
- **æŒ‡æ ‡ç±»å‹**: å®¹å™¨ CPUã€å†…å­˜ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿ
- **é›†æˆæ–¹å¼**: Kubelet å†…ç½®

#### Kube State Metrics
- **ç”¨é€”**: æ”¶é›† Kubernetes å¯¹è±¡çŠ¶æ€æŒ‡æ ‡
- **æŒ‡æ ‡ç±»å‹**: Podã€Serviceã€Deployment ç­‰çŠ¶æ€
- **éƒ¨ç½²æ–¹å¼**: Deployment

## ğŸ“Š æ•°æ®æ¨¡å‹

### Prometheus æ•°æ®æ¨¡å‹

```
æŒ‡æ ‡æ•°æ®ç»“æ„:
metric_name{label1="value1", label2="value2"} value timestamp

ç¤ºä¾‹:
http_requests_total{method="GET", status="200", instance="web-1"} 1234 1609459200
```

### æŒ‡æ ‡ç±»å‹

1. **Counter (è®¡æ•°å™¨)**
   - å•è°ƒé€’å¢çš„ç´¯ç§¯æŒ‡æ ‡
   - ç”¨é€”: è¯·æ±‚æ€»æ•°ã€é”™è¯¯æ€»æ•°
   - ç¤ºä¾‹: `http_requests_total`

2. **Gauge (ä»ªè¡¨ç›˜)**
   - å¯å¢å¯å‡çš„ç¬æ—¶å€¼
   - ç”¨é€”: CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡
   - ç¤ºä¾‹: `memory_usage_bytes`

3. **Histogram (ç›´æ–¹å›¾)**
   - è§‚å¯Ÿå€¼çš„åˆ†å¸ƒæƒ…å†µ
   - ç”¨é€”: è¯·æ±‚å»¶è¿Ÿã€å“åº”å¤§å°
   - ç¤ºä¾‹: `http_request_duration_seconds`

4. **Summary (æ‘˜è¦)**
   - è§‚å¯Ÿå€¼çš„åˆ†ä½æ•°ç»Ÿè®¡
   - ç”¨é€”: å»¶è¿Ÿåˆ†ä½æ•°ã€å¤§å°åˆ†ä½æ•°
   - ç¤ºä¾‹: `http_request_duration_seconds_summary`

## ğŸ”„ æ•°æ®æµå‘

### 1. æ•°æ®æ”¶é›†æµç¨‹

```
åº”ç”¨/ç³»ç»Ÿ â†’ Exporter â†’ Prometheus â†’ Grafana â†’ ç”¨æˆ·

è¯¦ç»†æµç¨‹:
1. åº”ç”¨æš´éœ² /metrics ç«¯ç‚¹
2. Prometheus å®šæœŸæŠ“å–æŒ‡æ ‡
3. æ•°æ®å­˜å‚¨åˆ°æ—¶åºæ•°æ®åº“
4. Grafana æŸ¥è¯¢å¹¶å¯è§†åŒ–
5. ç”¨æˆ·æŸ¥çœ‹ä»ªè¡¨æ¿
```

### 2. å‘Šè­¦æµç¨‹

```
æŒ‡æ ‡æ•°æ® â†’ å‘Šè­¦è§„åˆ™ â†’ AlertManager â†’ é€šçŸ¥æ¸ é“ â†’ è¿ç»´äººå‘˜

è¯¦ç»†æµç¨‹:
1. Prometheus è¯„ä¼°å‘Šè­¦è§„åˆ™
2. è§¦å‘å‘Šè­¦å‘é€åˆ° AlertManager
3. AlertManager å¤„ç†å‘Šè­¦è·¯ç”±
4. å‘é€é€šçŸ¥åˆ°æŒ‡å®šæ¸ é“
5. è¿ç»´äººå‘˜æ¥æ”¶å¹¶å¤„ç†
```

## ğŸš€ æ‰©å±•ç­–ç•¥

### 1. æ°´å¹³æ‰©å±•

**è”é‚¦é›†ç¾¤æ¶æ„**:
```
Global Prometheus
â”œâ”€â”€ Regional Prometheus 1
â”‚   â”œâ”€â”€ Cluster Prometheus A
â”‚   â””â”€â”€ Cluster Prometheus B
â””â”€â”€ Regional Prometheus 2
    â”œâ”€â”€ Cluster Prometheus C
    â””â”€â”€ Cluster Prometheus D
```

**é…ç½®ç¤ºä¾‹**:
```yaml
# å…¨å±€ Prometheus é…ç½®
scrape_configs:
  - job_name: 'federate'
    scrape_interval: 15s
    honor_labels: true
    metrics_path: '/federate'
    params:
      'match[]':
        - '{job=~"kubernetes-.*"}'
        - '{__name__=~"job:.*"}'
    static_configs:
      - targets:
        - 'prometheus-region-1:9090'
        - 'prometheus-region-2:9090'
```

### 2. å­˜å‚¨æ‰©å±•

**é•¿æœŸå­˜å‚¨æ–¹æ¡ˆ**:
- **Thanos**: åˆ†å¸ƒå¼ Prometheus å­˜å‚¨
- **Cortex**: å¤šç§Ÿæˆ· Prometheus æœåŠ¡
- **VictoriaMetrics**: é«˜æ€§èƒ½æ—¶åºæ•°æ®åº“

**Thanos æ¶æ„**:
```
Thanos ç»„ä»¶
â”œâ”€â”€ Thanos Sidecar (ä¸ Prometheus éƒ¨ç½²)
â”œâ”€â”€ Thanos Store Gateway (å¯¹è±¡å­˜å‚¨æ¥å£)
â”œâ”€â”€ Thanos Querier (æŸ¥è¯¢èšåˆ)
â”œâ”€â”€ Thanos Compactor (æ•°æ®å‹ç¼©)
â””â”€â”€ Thanos Ruler (è§„åˆ™è¯„ä¼°)
```

## ğŸ”’ å®‰å…¨è®¾è®¡

### 1. è®¤è¯å’Œæˆæƒ

**Grafana å®‰å…¨é…ç½®**:
```ini
[auth]
disable_login_form = false
disable_signout_menu = false

[auth.ldap]
enabled = true
config_file = /etc/grafana/ldap.toml

[security]
admin_user = admin
admin_password = $__env{GF_SECURITY_ADMIN_PASSWORD}
secret_key = $__env{GF_SECURITY_SECRET_KEY}
```

### 2. ç½‘ç»œå®‰å…¨

**ç½‘ç»œç­–ç•¥ç¤ºä¾‹**:
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: prometheus-network-policy
spec:
  podSelector:
    matchLabels:
      app: prometheus
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: grafana
    ports:
    - protocol: TCP
      port: 9090
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æŸ¥è¯¢ä¼˜åŒ–

**PromQL æœ€ä½³å®è·µ**:
```promql
# å¥½çš„æŸ¥è¯¢ - ä½¿ç”¨æ ‡ç­¾è¿‡æ»¤
rate(http_requests_total{job="api-server"}[5m])

# é¿å…çš„æŸ¥è¯¢ - è¿‡äºå®½æ³›
rate(http_requests_total[5m])

# èšåˆæŸ¥è¯¢ä¼˜åŒ–
sum by (instance) (rate(cpu_usage_seconds_total[5m]))
```

### 2. å­˜å‚¨ä¼˜åŒ–

**Prometheus å­˜å‚¨é…ç½®**:
```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  
# å­˜å‚¨é…ç½®
storage:
  tsdb:
    retention.time: 15d
    retention.size: 50GB
    wal-compression: true
```

## ğŸ¯ ç›‘æ§ç­–ç•¥

### 1. å››ä¸ªé»„é‡‘ä¿¡å·

1. **å»¶è¿Ÿ (Latency)**: è¯·æ±‚å¤„ç†æ—¶é—´
2. **æµé‡ (Traffic)**: ç³»ç»Ÿå¤„ç†çš„è¯·æ±‚é‡
3. **é”™è¯¯ (Errors)**: å¤±è´¥è¯·æ±‚çš„æ¯”ç‡
4. **é¥±å’Œåº¦ (Saturation)**: ç³»ç»Ÿèµ„æºä½¿ç”¨ç¨‹åº¦

### 2. SLI/SLO è®¾è®¡

**æœåŠ¡æ°´å¹³æŒ‡æ ‡ç¤ºä¾‹**:
```yaml
# SLI å®šä¹‰
availability_sli:
  query: |
    sum(rate(http_requests_total{status!~"5.."}[5m])) /
    sum(rate(http_requests_total[5m]))

latency_sli:
  query: |
    histogram_quantile(0.95,
      rate(http_request_duration_seconds_bucket[5m])
    )

# SLO ç›®æ ‡
slo_targets:
  availability: 99.9%  # 99.9% å¯ç”¨æ€§
  latency_p95: 200ms   # 95% è¯·æ±‚ < 200ms
```

## ğŸ“‹ éƒ¨ç½²æ¸…å•

### ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•

- [ ] **é«˜å¯ç”¨éƒ¨ç½²**: å¤šå®ä¾‹éƒ¨ç½²ï¼Œé¿å…å•ç‚¹æ•…éšœ
- [ ] **æ•°æ®æŒä¹…åŒ–**: é…ç½®æŒä¹…åŒ–å­˜å‚¨
- [ ] **å¤‡ä»½ç­–ç•¥**: å®šæœŸå¤‡ä»½é…ç½®å’Œæ•°æ®
- [ ] **ç›‘æ§ç›‘æ§**: ç›‘æ§ç³»ç»Ÿæœ¬èº«çš„å¥åº·çŠ¶æ€
- [ ] **å®‰å…¨é…ç½®**: å¯ç”¨è®¤è¯ã€æˆæƒå’ŒåŠ å¯†
- [ ] **èµ„æºé™åˆ¶**: è®¾ç½®åˆç†çš„èµ„æºè¯·æ±‚å’Œé™åˆ¶
- [ ] **å‘Šè­¦é…ç½®**: é…ç½®å…³é”®æŒ‡æ ‡çš„å‘Šè­¦è§„åˆ™
- [ ] **æ–‡æ¡£ç»´æŠ¤**: ç»´æŠ¤éƒ¨ç½²å’Œè¿ç»´æ–‡æ¡£

---

**ä¸‹ä¸€æ­¥**: æŸ¥çœ‹ [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT_GUIDE.md) äº†è§£å…·ä½“çš„éƒ¨ç½²æ­¥éª¤å’Œé…ç½®æ–¹æ³•ã€‚
